generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Mentor {
  id              Int              @id @default(autoincrement())
  name            String
  email           String           @unique
  avatarPath      String           @default("") @map("avatar_path")
  createdAt       DateTime         @default(now()) @map("created_at")
  signups         Signup[]
  hourAdjustments HourAdjustment[]

  @@map("mentors")
}

model ShiftTemplate {
  id        Int     @id @default(autoincrement())
  dayOfWeek Int     @map("day_of_week") // 0=Sunday, 6=Saturday
  startTime String  @map("start_time") // "18:00"
  endTime   String  @map("end_time") // "21:00"
  label     String  @default("")
  active    Boolean @default(true)
  shifts    Shift[]

  @@map("shift_templates")
}

model Shift {
  id         Int            @id @default(autoincrement())
  date       String // "2026-02-14" ISO date
  startTime  String         @map("start_time")
  endTime    String         @map("end_time")
  label      String         @default("")
  cancelled  Boolean        @default(false)
  templateId Int?           @map("template_id")
  template   ShiftTemplate? @relation(fields: [templateId], references: [id])
  createdAt  DateTime       @default(now()) @map("created_at")
  signups    Signup[]

  @@unique([date, startTime, endTime])
  @@index([date])
  @@map("shifts")
}

model Signup {
  id         Int      @id @default(autoincrement())
  mentorId   Int      @map("mentor_id")
  shiftId    Int      @map("shift_id")
  note            String   @default("")
  customStartTime String?  @map("custom_start_time")
  customEndTime   String?  @map("custom_end_time")
  signedUpAt      DateTime  @default(now()) @map("signed_up_at")
  checkedInAt     DateTime? @map("checked_in_at")
  virtual         Boolean   @default(false)
  mentor          Mentor    @relation(fields: [mentorId], references: [id])
  shift           Shift     @relation(fields: [shiftId], references: [id])

  @@unique([mentorId, shiftId])
  @@index([shiftId])
  @@index([mentorId])
  @@map("signups")
}

model Season {
  id        Int    @id @default(autoincrement())
  name      String // "2026 Build Season"
  startDate String @map("start_date") // "2026-01-06"
  endDate   String @map("end_date") // "2026-04-15"

  @@map("seasons")
}

model HourAdjustment {
  id        Int      @id @default(autoincrement())
  mentorId  Int      @map("mentor_id")
  hours     Float
  reason    String   @default("")
  date      String // ISO date for season filtering
  createdAt DateTime @default(now()) @map("created_at")
  mentor    Mentor   @relation(fields: [mentorId], references: [id])

  @@index([mentorId])
  @@index([date])
  @@map("hour_adjustments")
}

model Setting {
  key   String @id
  value String

  @@map("settings")
}

model Quote {
  id        Int      @id @default(autoincrement())
  text      String
  author    String   @default("")
  active    Boolean  @default(true)
  pending   Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")

  @@map("quotes")
}

model DailyGoal {
  date      String   @id
  text      String   @default("")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("daily_goals")
}

model Student {
  id          Int                 @id @default(autoincrement())
  name        String
  createdAt   DateTime            @default(now()) @map("created_at")
  attendances StudentAttendance[]

  @@map("students")
}

model StudentAttendance {
  id          Int      @id @default(autoincrement())
  studentId   Int      @map("student_id")
  date        String // ISO date "2026-02-14"
  checkedInAt DateTime @default(now()) @map("checked_in_at")
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, date])
  @@index([date])
  @@index([studentId])
  @@map("student_attendance")
}
